import C from"node:path";import w from"fs-extra";import E from"knex";import b from"camelcase";function N(t,d,l){const h=l.nullish&&l.nullish===!0,s=l.requiredString&&l.requiredString===!0,f=t.split("(")[0].split(" ")[0],i=d==="YES",o=["z.string()"],u=["z.number()"],c=h?"nullish()":"nullable()",m="nonnegative()",e="min(1)";switch(f){case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"tinytext":case"text":case"mediumtext":case"longtext":case"json":case"decimal":return i?o.push(c):s&&o.push(e),o.join(".");case"tinyint":case"smallint":case"mediumint":case"int":case"bigint":case"float":case"double":return t.endsWith(" unsigned")&&u.push(m),i&&u.push(c),u.join(".");case"enum":return`z.enum([${t.replace("enum(","").replace(")","").replace(/,/g,", ")}])`}}async function j(t){const d=E({client:"mysql2",connection:{host:t.host,port:t.port,user:t.user,password:t.password,database:t.database}}),l=t.camelCase&&t.camelCase===!0;let s=(await d.raw("SELECT table_name as table_name FROM information_schema.tables WHERE table_schema = ?",[t.database]))[0].map(e=>e.table_name).filter(e=>!e.startsWith("knex_")).sort();const f=t.tables,i=f?.filter(e=>e.startsWith("/")&&e.endsWith("/")),o=f?.filter(e=>i?.includes(e));o&&o.length&&(s=s.filter(e=>{if(o.includes(e))return!0;let n=!1;return i&&i.length&&i.forEach(r=>{const a=r.substring(1,r.length-1);e.match(a)!==null&&(n=!0)}),n}));const u=t.ignore,c=u?.filter(e=>e.startsWith("/")&&e.endsWith("/")),m=u?.filter(e=>!c?.includes(e));m&&m.length&&(s=s.filter(e=>!m.includes(e))),c&&c.length&&(s=s.filter(e=>{let n=!0;return c.forEach(r=>{const a=r.substring(1,r.length-1);e.match(a)!==null&&(n=!1)}),n}));for(let e of s){const r=(await d.raw(`DESC ${e}`))[0];l&&(e=b(e));let a=`import z from 'zod'

export const ${e} = z.object({`;for(const p of r){const T=l?b(p.Field):p.Field,$=N(p.Type,p.Null,t);a=`${a}
  ${T}: ${$},`}a=`${a}
})

export type ${b(`${e}Type`)} = z.infer<typeof ${e}>
`;const y=t.folder&&t.folder!==""?t.folder:".",x=t.suffix&&t.suffix!==""?`${e}.${t.suffix}.ts`:`${e}.ts`,g=C.join(y,x);console.log("Created:",g),w.outputFileSync(g,a)}await d.destroy()}export{j as generate};
